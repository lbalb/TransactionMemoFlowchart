<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IC Production Blueprint — Flowchart Navigator</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700&display=swap');

  :root {
    --bg-primary: #0a0c10;
    --bg-secondary: #12151c;
    --bg-card: #181c26;
    --bg-card-hover: #1e2330;
    --border: #2a3040;
    --border-active: #4a6fa5;
    --text-primary: #e8ecf4;
    --text-secondary: #8892a6;
    --text-muted: #5a6478;
    --accent-blue: #4a8eff;
    --accent-teal: #3ecfb4;
    --accent-amber: #f0a050;
    --accent-rose: #e05882;
    --accent-violet: #8b6cf0;
    --stage-hook: #4a8eff;
    --stage-opportunity: #3ecfb4;
    --stage-proof: #f0a050;
    --stage-team: #e05882;
    --stage-numbers: #8b6cf0;
    --stage-ask: #56c4e8;
    --stage-risk: #e8a04a;
    --stage-prepost: #6b7a96;
    --glass: rgba(24, 28, 38, 0.85);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.4);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Outfit', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Subtle background grain */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: radial-gradient(ellipse at 20% 0%, rgba(74,142,255,0.06) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 100%, rgba(139,108,240,0.05) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  .app { position: relative; z-index: 1; }

  /* HEADER */
  .header {
    padding: 48px 40px 32px;
    max-width: 1400px;
    margin: 0 auto;
  }
  .header-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--accent-blue);
    margin-bottom: 12px;
  }
  .header h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 42px;
    font-weight: 400;
    line-height: 1.15;
    color: var(--text-primary);
    margin-bottom: 8px;
  }
  .header p {
    font-size: 16px;
    color: var(--text-secondary);
    font-weight: 300;
    max-width: 700px;
    line-height: 1.6;
  }

  /* NAV */
  .nav-bar {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(10, 12, 16, 0.92);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    padding: 0 40px;
  }
  .nav-inner {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    gap: 4px;
    overflow-x: auto;
    padding: 10px 0;
    scrollbar-width: none;
  }
  .nav-inner::-webkit-scrollbar { display: none; }

  .nav-btn {
    font-family: 'Outfit', sans-serif;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
    padding: 7px 14px;
    border-radius: 6px;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  .nav-btn:hover {
    color: var(--text-secondary);
    background: var(--bg-card);
  }
  .nav-btn.active {
    color: var(--text-primary);
    background: var(--bg-card);
    border-color: var(--border-active);
  }
  .nav-btn.overview-btn {
    color: var(--accent-blue);
    border-color: rgba(74,142,255,0.3);
  }
  .nav-btn.overview-btn.active {
    background: rgba(74,142,255,0.12);
    border-color: var(--accent-blue);
  }

  /* MAIN CONTENT */
  .main {
    max-width: 1400px;
    margin: 0 auto;
    padding: 32px 40px 80px;
  }

  /* SECTION NAV ARROWS */
  .section-nav {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 20px;
  }
  .nav-arrow {
    font-family: 'Outfit', sans-serif;
    font-size: 13px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--bg-card);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    max-width: 260px;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .nav-arrow:hover {
    border-color: var(--accent-blue);
    color: var(--text-primary);
    background: var(--bg-card-hover);
  }
  .nav-arrow:disabled {
    opacity: 0.25;
    cursor: default;
    pointer-events: none;
  }
  .nav-arrow svg {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }
  .nav-arrow-label {
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .section-nav-spacer {
    flex: 1;
  }
  .section-nav-counter {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-muted);
    white-space: nowrap;
  }

  /* SECTION CARD */
  .section-view {
    animation: fadeIn 0.3s ease;
  }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .section-header {
    margin-bottom: 28px;
  }
  .section-stage-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 8px;
    display: inline-block;
    padding: 3px 10px;
    border-radius: 4px;
  }
  .section-title {
    font-family: 'DM Serif Display', serif;
    font-size: 30px;
    font-weight: 400;
    margin-bottom: 6px;
  }
  .section-desc {
    font-size: 15px;
    color: var(--text-secondary);
    font-weight: 300;
    max-width: 800px;
    line-height: 1.6;
  }

  /* FLOWCHART CONTAINER */
  .flowchart-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    margin-bottom: 24px;
  }
  .flowchart-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 20px;
    border-bottom: 1px solid var(--border);
    background: var(--bg-secondary);
  }
  .flowchart-toolbar-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    color: var(--text-muted);
    text-transform: uppercase;
  }
  .copy-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    padding: 6px 14px;
    border-radius: 5px;
    border: 1px solid var(--border);
    background: var(--bg-primary);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .copy-btn:hover {
    border-color: var(--accent-blue);
    color: var(--accent-blue);
  }
  .copy-btn.copied {
    border-color: var(--accent-teal);
    color: var(--accent-teal);
  }
  .copy-btn svg { width: 13px; height: 13px; }

  .flowchart-render {
    padding: 32px 24px;
    display: flex;
    justify-content: center;
    overflow-x: auto;
    min-height: 200px;
  }
  .flowchart-render .mermaid {
    width: 100%;
    display: flex;
    justify-content: center;
  }
  .flowchart-render svg {
    max-width: 100%;
    height: auto;
  }

  /* CODE VIEW */
  .code-toggle {
    padding: 12px 20px;
    border-top: 1px solid var(--border);
  }
  .code-toggle-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--text-muted);
    background: none;
    border: none;
    cursor: pointer;
    padding: 4px 0;
  }
  .code-toggle-btn:hover { color: var(--text-secondary); }
  .code-block {
    padding: 0 20px 20px;
    display: none;
  }
  .code-block.visible { display: block; }
  .code-block pre {
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    line-height: 1.6;
    color: var(--text-secondary);
    background: var(--bg-primary);
    padding: 16px;
    border-radius: 8px;
    overflow-x: auto;
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* OVERVIEW GRID */
  .overview-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .header { padding: 32px 20px 24px; }
    .header h1 { font-size: 28px; }
    .nav-bar { padding: 0 16px; }
    .main { padding: 24px 16px 60px; }
    .section-title { font-size: 24px; }
    .flowchart-render { padding: 20px 12px; }
  }

  /* PREV/NEXT NAV */
  .section-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 28px;
    gap: 16px;
  }
  .section-nav-btn {
    font-family: 'Outfit', sans-serif;
    font-size: 13px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px 20px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: var(--bg-card);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    max-width: 45%;
    text-align: left;
  }
  .section-nav-btn:hover {
    border-color: var(--border-active);
    color: var(--text-primary);
    background: var(--bg-card-hover);
  }
  .section-nav-btn.disabled {
    opacity: 0.25;
    pointer-events: none;
  }
  .section-nav-btn .nav-arrow {
    font-size: 18px;
    flex-shrink: 0;
    line-height: 1;
    color: var(--accent-blue);
  }
  .section-nav-btn .nav-label {
    display: flex;
    flex-direction: column;
    gap: 2px;
    overflow: hidden;
  }
  .section-nav-btn .nav-dir {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--text-muted);
  }
  .section-nav-btn .nav-name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .section-nav-btn.next { text-align: right; margin-left: auto; }
  .section-nav-btn.next .nav-label { align-items: flex-end; }

  /* Mermaid theme overrides */
  .mermaid text { fill: var(--text-primary) !important; }
  .mermaid .nodeLabel { color: var(--text-primary) !important; }
</style>
</head>
<body>
<div class="app" id="app"></div>

<script>
// ──────────────────────────────────────────────
// DATA: All sections with their mermaid flowcharts
// ──────────────────────────────────────────────
const sections = [
  {
    id: 'overview',
    title: 'Full Blueprint Overview',
    stage: 'Overview',
    stageColor: 'var(--accent-blue)',
    desc: 'End-to-end flow across all 7 stages, 20 sections, and 5 validation gates.',
    mermaid: `flowchart TD
    subgraph PRE["PRE-PRODUCTION CONTROLS"]
        TI["Transaction Intake\\n& Scoping"] --> PB["Page Budget\\nArchitecture"]
        PB --> VG["Validation Gates\\nDefinition"]
    end

    subgraph S1["STAGE 1: THE HOOK"]
        ES["S1: Executive Summary"] --> CO["S2: Company Overview"]
    end

    subgraph S2["STAGE 2: THE OPPORTUNITY"]
        MO["S3: Market Opportunity"] --> PS["S4: Problem & Solution"]
        PS --> BM["S5: Business Model"]
    end

    subgraph S3["STAGE 3: THE PROOF"]
        TR["S6: Traction &\\nKey Metrics"] --> CL["S7: Competitive\\nLandscape"]
        CL --> GTM["S8: GTM Strategy"]
    end

    subgraph S4["STAGE 4: THE TEAM"]
        TL["S9: Team &\\nLeadership"] --> BA["S10: Board &\\nAdvisors"]
    end

    subgraph S5["STAGE 5: THE NUMBERS"]
        HF["S11: Historical\\nFinancials"] --> FP["S12: Financial\\nProjections"]
        FP --> CR["S13: Cash &\\nRunway"]
    end

    subgraph S6["STAGE 6: THE ASK"]
        RA["S14: The Raise"] --> VS["S15: Valuation\\nSupport"]
    end

    subgraph S7["STAGE 7: RISK & CLOSE"]
        RK["S16: Key Risks\\n& Mitigants"] --> MS["S17: Milestones\\n& Path Forward"]
        MS --> AP["S18: Appendices"]
    end

    subgraph POST["DECISION & PRODUCTION"]
        DA["S19: Decision &\\nApproval Block"] --> PC["Pre-Submission\\nChecklist"]
    end

    PRE -->|"Gate 1: Metrics Lock"| S1
    S1 --> S2
    S2 --> S3
    S3 -->|"Gate 2: Financial Recon"| S4
    S4 --> S5
    S5 -->|"Gate 3: Cap Table Recon"| S6
    S6 -->|"Gate 4: Appendix Check"| S7
    S7 -->|"Gate 5: Sign-Off"| POST

    style PRE fill:#1a2235,stroke:#6b7a96,color:#e8ecf4
    style S1 fill:#162040,stroke:#4a8eff,color:#e8ecf4
    style S2 fill:#142a2a,stroke:#3ecfb4,color:#e8ecf4
    style S3 fill:#2a2010,stroke:#f0a050,color:#e8ecf4
    style S4 fill:#2a1525,stroke:#e05882,color:#e8ecf4
    style S5 fill:#1e1535,stroke:#8b6cf0,color:#e8ecf4
    style S6 fill:#122a30,stroke:#56c4e8,color:#e8ecf4
    style S7 fill:#2a2010,stroke:#e8a04a,color:#e8ecf4
    style POST fill:#1a2235,stroke:#6b7a96,color:#e8ecf4`
  },
  {
    id: 'pre-intake',
    title: 'Transaction Intake & Scoping',
    stage: 'Pre-Production',
    stageColor: 'var(--stage-prepost)',
    desc: 'Define transaction parameters, assign ownership, and resolve scoping decisions before any drafting begins.',
    mermaid: `flowchart TD
    A["Start: Memo Production\\nTriggered"] --> B["Define Transaction\\nParameters"]
    B --> B1["Transaction Type\\n(Priced/SAFE/Note/Bridge)"]
    B --> B2["Round Size\\n& Valuation Basis"]
    B --> B3["Decision Required\\n& Target Audience"]
    B --> B4["Data Cutoff Date\\n& Timeline"]
    B1 & B2 & B3 & B4 --> C["Assign Ownership\\n& Accountability"]
    C --> C1["Memo Owner"]
    C --> C2["Financial Data Owner"]
    C --> C3["Legal/Cap Table Owner"]
    C --> C4["Product/GTM Owner"]
    C --> C5["CEO/Final Approver"]
    C1 & C2 & C3 & C4 & C5 --> D["Resolve Scoping\\nDecisions"]
    D --> D1["Secondary Liquidity?"]
    D --> D2["Insider Participation?"]
    D --> D3["Lead Investor Status?"]
    D --> D4["Syndicate Strategy"]
    D --> D5["Confidentiality Tier"]
    D1 & D2 & D3 & D4 & D5 --> E{"All Scoping\\nResolved?"}
    E -->|No| D
    E -->|Yes| F["Proceed to\\nPage Budget"]

    style A fill:#2a3550,stroke:#6b7a96,color:#e8ecf4
    style F fill:#1a3040,stroke:#4a8eff,color:#e8ecf4
    style E fill:#2a2a10,stroke:#f0a050,color:#e8ecf4`
  },
  {
    id: 'pre-pagebudget',
    title: 'Page Budget Architecture',
    stage: 'Pre-Production',
    stageColor: 'var(--stage-prepost)',
    desc: 'Enforce memo length discipline: 20-page core + 30-40 page appendix. Overflow moves to appendices.',
    mermaid: `flowchart TD
    A["Page Budget\\nPlanning"] --> B["Set Core Memo\\nTarget: 20 pages"]
    A --> C["Set Appendix\\nTarget: 30-40 pages"]
    B --> D["Allocate Pages\\nper Section"]
    D --> D1["S1 Exec Summary: 1pg"]
    D --> D2["S3 Market: 2pg core\\n+ 2-4pg appendix"]
    D --> D3["S6 Traction: 2pg core\\n+ 3-5pg appendix"]
    D --> D4["S11-12 Financials: 4pg core\\n+ 6-10pg appendix"]
    D --> D5["S15 Valuation: 2pg core\\n+ 3-5pg appendix"]
    D1 & D2 & D3 & D4 & D5 --> E{"Section Exceeds\\nCap by >50%?"}
    E -->|Yes| F["Move Excess to\\nAppendix Overflow"]
    E -->|No| G["Section Approved"]
    F --> G
    G --> H["Stage-Adjust:\\nEarly = Lower End\\nPre-IPO = Upper Bound"]
    H --> I["Total Package:\\n50-60 Pages"]

    style A fill:#2a3550,stroke:#6b7a96,color:#e8ecf4
    style E fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style I fill:#1a3040,stroke:#4a8eff,color:#e8ecf4`
  },
  {
    id: 'pre-gates',
    title: 'Validation Gates',
    stage: 'Pre-Production',
    stageColor: 'var(--stage-prepost)',
    desc: '5 hard checkpoints enforcing data integrity. No section is draft-complete until its gates pass.',
    mermaid: `flowchart TD
    A["Gate System\\nInitialization"] --> G1

    subgraph G1["GATE 1: Metrics Definition Lock"]
        G1a["Lock ARR Definition"] --> G1b["Lock NRR Methodology"]
        G1b --> G1c["Lock Churn & CAC Scope"]
        G1c --> G1d["Financial Data Owner\\nSigns Off"]
    end

    G1 --> G2

    subgraph G2["GATE 2: Financial Reconciliation"]
        G2a["Memo → Model Mapping\\n(each number to cell)"] --> G2b["Model → Actuals\\n(<1% variance)"]
        G2b --> G2c["Internal Consistency\\n(S1=S6=S11=Model)"]
        G2c --> G2d["Finance + Memo Owner\\nJoint Sign-Off"]
    end

    G2 --> G3

    subgraph G3["GATE 3: Cap Table & Legal"]
        G3a["Verify Ownership %"] --> G3b["Option Pool &\\nConvertibles"]
        G3b --> G3c["Pro Forma Post-Raise"]
        G3c --> G3d["Legal Counsel\\nSign-Off"]
    end

    G3 --> G4

    subgraph G4["GATE 4: Appendix Completeness"]
        G4a["Every Claim →\\nAppendix Evidence"] --> G4b["Customer Refs Cleared"]
        G4b --> G4c["Screenshots Current"]
        G4c --> G4d["Market Data Cited"]
    end

    G4 --> G5

    subgraph G5["GATE 5: Sign-Off Gate"]
        G5a["Finance Owner ✓"] --> G5b["Legal Owner ✓"]
        G5b --> G5c["CEO ✓"]
        G5c --> G5d["Memo Owner ✓"]
    end

    G5 --> Z["Cleared for\\nDistribution"]

    style G1 fill:#162040,stroke:#4a8eff,color:#e8ecf4
    style G2 fill:#142a2a,stroke:#3ecfb4,color:#e8ecf4
    style G3 fill:#2a2010,stroke:#f0a050,color:#e8ecf4
    style G4 fill:#2a1525,stroke:#e05882,color:#e8ecf4
    style G5 fill:#1e1535,stroke:#8b6cf0,color:#e8ecf4
    style Z fill:#1a3040,stroke:#4a8eff,color:#e8ecf4`
  },
  {
    id: 's1',
    title: 'S1: Executive Summary',
    stage: 'Stage 1 — The Hook',
    stageColor: 'var(--stage-hook)',
    desc: 'The single most important page. Answer: What, Achieved, Raising, Deploy, Why Now.',
    mermaid: `flowchart TD
    A["Begin Executive\\nSummary"] --> B["One-Sentence Company\\nDescription"]
    B --> C["Round Details"]
    C --> C1["Amount Raising"]
    C --> C2["Target Valuation"]
    C --> C3["Use of Proceeds\\n(high-level %)"]
    C1 & C2 & C3 --> D["3-5 Headline Metrics"]
    D --> D1["ARR / Revenue"]
    D --> D2["Growth Rate"]
    D --> D3["NRR"]
    D --> D4["Customer Count"]
    D1 & D2 & D3 & D4 --> E["Forward-Looking\\nMilestone Statement"]
    E --> F{"Stage\\nAdaptation"}
    F -->|Series A| FA["Lead with vision\\n& PMF signals"]
    F -->|Series B| FB["Lead with proven\\nmetrics & multiples"]
    F -->|Pre-IPO| FC["Institutional-grade\\n+ IPO timeline"]
    FA & FB & FC --> G["Pull from Model\\nSummary Tab"]
    G --> H{"Page ≤ 1?"}
    H -->|No| I["Trim & move\\ndetail to appendix"]
    H -->|Yes| J["Section Complete\\n— Write Last!"]
    I --> H

    style A fill:#162040,stroke:#4a8eff,color:#e8ecf4
    style J fill:#1a3040,stroke:#4a8eff,color:#e8ecf4
    style F fill:#2a2a10,stroke:#f0a050,color:#e8ecf4`
  },
  {
    id: 's2',
    title: 'S2: Company Overview',
    stage: 'Stage 1 — The Hook',
    stageColor: 'var(--stage-hook)',
    desc: 'Foundational context: mission, founding story, corporate structure, cap table summary.',
    mermaid: `flowchart TD
    A["Begin Company\\nOverview"] --> B["Mission & Vision"]
    B --> C["Founding Story\\n(Who, When, Why)"]
    C --> D["Current Stage &\\nMilestones"]
    D --> D1["Product Launch"]
    D --> D2["First Revenue"]
    D --> D3["Key Hires"]
    D --> D4["Prior Rounds"]
    D1 & D2 & D3 & D4 --> E["Corporate Structure"]
    E --> E1["Entity Type &\\nJurisdiction"]
    E --> E2["Subsidiaries"]
    E1 & E2 --> F["Cap Table Summary"]
    F --> F1["Founders %"]
    F --> F2["Employee Pool %"]
    F --> F3["Investor % by Round"]
    F1 & F2 & F3 --> G{"Reconcile with\\nCap Table Tab?"}
    G -->|Mismatch| H["Resolve with\\nLegal Owner"]
    G -->|Match| I["Section Complete"]
    H --> G

    style A fill:#162040,stroke:#4a8eff,color:#e8ecf4
    style G fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style I fill:#1a3040,stroke:#4a8eff,color:#e8ecf4`
  },
  {
    id: 's3',
    title: 'S3: Market Opportunity',
    stage: 'Stage 2 — The Opportunity',
    stageColor: 'var(--stage-opportunity)',
    desc: 'TAM/SAM/SOM with dual methodology, market tailwinds, and timing rationale.',
    mermaid: `flowchart TD
    A["Begin Market\\nOpportunity"] --> B["TAM Calculation"]
    B --> B1["Top-Down\\n(Industry Reports)"]
    B --> B2["Bottom-Up\\n(Customers × ACV)"]
    B1 & B2 --> C{"Top-Down ≈\\nBottom-Up?"}
    C -->|No| D["Reconcile &\\nExplain Delta"]
    C -->|Yes| E["Derive SAM"]
    D --> E
    E --> F["Derive SOM\\n(Near-Term Target)"]
    F --> G["Market Growth\\nRate (CAGR)"]
    G --> H["2-4 Key Tailwinds"]
    H --> I["Regulatory\\nLandscape"]
    I --> J["Why Now?\\nTiming Dynamics"]
    J --> K{"SOM Consistent\\nwith Revenue\\nProjections?"}
    K -->|No| L["Adjust SOM or\\nRevise Model"]
    K -->|Yes| M["Section Complete"]
    L --> K

    style A fill:#142a2a,stroke:#3ecfb4,color:#e8ecf4
    style C fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style K fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style M fill:#1a3040,stroke:#3ecfb4,color:#e8ecf4`
  },
  {
    id: 's4',
    title: 'S4: Problem & Solution',
    stage: 'Stage 2 — The Opportunity',
    stageColor: 'var(--stage-opportunity)',
    desc: 'Make the investor feel the pain, then present the resolution with customer evidence.',
    mermaid: `flowchart TD
    A["Begin Problem\\n& Solution"] --> B["Define Customer\\nPain Points"]
    B --> B1["Who Experiences It?"]
    B --> B2["How Frequently?"]
    B --> B3["Cost: $, Time,\\nOpportunity Cost"]
    B1 & B2 & B3 --> C["Current Alternatives\\n& Their Limitations"]
    C --> D["Present Your\\nSolution"]
    D --> D1["Core Mechanism\\nof Value Delivery"]
    D --> D2["NOT a Feature List"]
    D1 & D2 --> E["Customer Validation"]
    E --> E1["Quotes / NPS"]
    E --> E2["Case Studies"]
    E --> E3["Time-to-Value"]
    E1 & E2 & E3 --> F{"Stage\\nAdaptation"}
    F -->|Series A| FA["Discovery interviews\\n& MVP results"]
    F -->|Series B| FB["Case studies\\nwith ROI data"]
    F -->|Pre-IPO| FC["Enterprise readiness\\n& cohort analysis"]
    FA & FB & FC --> G["Section Complete"]

    style A fill:#142a2a,stroke:#3ecfb4,color:#e8ecf4
    style F fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style G fill:#1a3040,stroke:#3ecfb4,color:#e8ecf4`
  },
  {
    id: 's5',
    title: 'S5: Business Model',
    stage: 'Stage 2 — The Opportunity',
    stageColor: 'var(--stage-opportunity)',
    desc: 'Revenue model, unit economics (LTV/CAC), gross margins, and expansion mechanics.',
    mermaid: `flowchart TD
    A["Begin Business\\nModel"] --> B["Revenue Model"]
    B --> B1["Pricing Tiers"]
    B --> B2["Contract Terms"]
    B --> B3["Usage Components"]
    B1 & B2 & B3 --> C["Unit Economics"]
    C --> C1["ACV / ARPU"]
    C --> C2["LTV = ARPU ×\\nGross Margin / Churn"]
    C --> C3["CAC (Fully Loaded)"]
    C --> C4["LTV:CAC Ratio\\n(Target >3x)"]
    C --> C5["CAC Payback\\n(Target <18mo)"]
    C1 & C2 & C3 & C4 & C5 --> D["Gross Margin\\nProfile & Trend"]
    D --> E["Expansion Revenue\\nMechanics"]
    E --> F["Revenue\\nConcentration Risk"]
    F --> G{"Pulls from Unit\\nEcon Tab Match?"}
    G -->|No| H["Reconcile\\nwith Model"]
    G -->|Yes| I["Section Complete"]
    H --> G

    style A fill:#142a2a,stroke:#3ecfb4,color:#e8ecf4
    style G fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style I fill:#1a3040,stroke:#3ecfb4,color:#e8ecf4`
  },
  {
    id: 's6',
    title: 'S6: Traction & Key Metrics',
    stage: 'Stage 3 — The Proof',
    stageColor: 'var(--stage-proof)',
    desc: 'Quantitative proof: revenue trajectory, retention, efficiency metrics with 4-6 quarters of trend.',
    mermaid: `flowchart TD
    A["Begin Traction\\n& Key Metrics"] --> B["Revenue Trajectory"]
    B --> B1["MRR/ARR Chart\\n(Monthly + Annual)"]
    B --> B2["YoY & QoQ\\nGrowth Rates"]
    B1 & B2 --> C["Customer Metrics"]
    C --> C1["Total Customers"]
    C --> C2["New per Quarter"]
    C --> C3["Logo Churn Rate"]
    C1 & C2 & C3 --> D["Retention Metrics"]
    D --> D1["NRR (Target >110%)"]
    D --> D2["Gross Retention\\n(Target >85%)"]
    D1 & D2 --> E["Efficiency Metrics"]
    E --> E1["Burn Multiple\\n(Target <2x)"]
    E --> E2["Revenue per\\nEmployee"]
    E --> E3["Pipeline Multiple"]
    E1 & E2 & E3 --> F{"4-6 Quarters\\nof Data?"}
    F -->|No| G["Use Available Data\\n+ Leading Indicators"]
    F -->|Yes| H{"Every Metric\\nTraces to Model?"}
    G --> H
    H -->|No| I["Add to Model or\\nRemove from Memo"]
    H -->|Yes| J["Section Complete"]
    I --> H

    style A fill:#2a2010,stroke:#f0a050,color:#e8ecf4
    style F fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style H fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style J fill:#1a3040,stroke:#f0a050,color:#e8ecf4`
  },
  {
    id: 's7',
    title: 'S7: Competitive Landscape',
    stage: 'Stage 3 — The Proof',
    stageColor: 'var(--stage-proof)',
    desc: 'Honest positioning map, moat evidence, win/loss data, and build-vs-buy assessment.',
    mermaid: `flowchart TD
    A["Begin Competitive\\nLandscape"] --> B["Build Positioning\\nMap (2x2 Matrix)"]
    B --> C["Identify Competitors"]
    C --> C1["Direct Competitors"]
    C --> C2["Adjacent Competitors"]
    C --> C3["Potential Future\\nEntrants"]
    C1 & C2 & C3 --> D["Per Competitor:\\nStrengths/Weaknesses"]
    D --> E["Define Your Moats"]
    E --> E1["Network Effects"]
    E --> E2["Switching Costs"]
    E --> E3["Data Advantages"]
    E --> E4["Proprietary Tech"]
    E --> E5["Regulatory Moat"]
    E1 & E2 & E3 & E4 & E5 --> F["Win/Loss Data"]
    F --> G["Build vs. Buy\\nRisk"]
    G --> H{"Evidence-Backed\\nDifferentiation?"}
    H -->|No| I["Strengthen Claims\\nor Adjust Position"]
    H -->|Yes| J["Section Complete"]
    I --> H

    style A fill:#2a2010,stroke:#f0a050,color:#e8ecf4
    style H fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style J fill:#1a3040,stroke:#f0a050,color:#e8ecf4`
  },
  {
    id: 's8',
    title: 'S8: GTM Strategy',
    stage: 'Stage 3 — The Proof',
    stageColor: 'var(--stage-proof)',
    desc: 'Repeatable acquisition engine: sales motion, funnel metrics, expansion playbook.',
    mermaid: `flowchart TD
    A["Begin GTM\\nStrategy"] --> B["Define Sales Motion"]
    B --> B1["PLG"]
    B --> B2["Direct Enterprise"]
    B --> B3["Channel/Partner"]
    B --> B4["Hybrid"]
    B1 & B2 & B3 & B4 --> C["Funnel Metrics"]
    C --> C1["Lead → Opportunity"]
    C --> C2["Opportunity → Close"]
    C --> C3["Sales Cycle Length"]
    C1 & C2 & C3 --> D["Sales Team\\nProductivity"]
    D --> D1["Quota Attainment\\n(Target >60%)"]
    D --> D2["Rep Ramp Time"]
    D --> D3["Magic Number\\n(Target >0.75)"]
    D1 & D2 & D3 --> E["CAC by Channel"]
    E --> F["Expansion Playbook"]
    F --> F1["Upsell Triggers"]
    F --> F2["Cross-Sell Paths"]
    F --> F3["Land & Expand"]
    F1 & F2 & F3 --> G{"Reconciles with\\nHiring Plan &\\nSales Capacity?"}
    G -->|No| H["Align Model\\nAssumptions"]
    G -->|Yes| I["Section Complete"]
    H --> G

    style A fill:#2a2010,stroke:#f0a050,color:#e8ecf4
    style G fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style I fill:#1a3040,stroke:#f0a050,color:#e8ecf4`
  },
  {
    id: 's9',
    title: 'S9: Team & Leadership',
    stage: 'Stage 4 — The Team',
    stageColor: 'var(--stage-team)',
    desc: 'Founder profiles, org structure, key hires planned, retention metrics.',
    mermaid: `flowchart TD
    A["Begin Team\\n& Leadership"] --> B["Founder & C-Suite\\nProfiles"]
    B --> B1["Domain Expertise"]
    B --> B2["Prior Exits"]
    B --> B3["Industry Tenure"]
    B1 & B2 & B3 --> C["Org Structure"]
    C --> C1["Headcount by\\nDepartment"]
    C --> C2["How Structure\\nSupports Strategy"]
    C1 & C2 --> D["Key Hires Planned\\nwith This Capital"]
    D --> E["Leadership Gaps\\n& Plan to Fill"]
    E --> F["Retention Metrics"]
    F --> F1["Voluntary Turnover"]
    F --> F2["Average Tenure"]
    F1 & F2 --> G{"Headcount Matches\\nHiring Plan in Model?"}
    G -->|No| H["Reconcile"]
    G -->|Yes| I["Section Complete"]
    H --> G

    style A fill:#2a1525,stroke:#e05882,color:#e8ecf4
    style G fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style I fill:#1a3040,stroke:#e05882,color:#e8ecf4`
  },
  {
    id: 's10',
    title: 'S10: Board & Advisors',
    stage: 'Stage 4 — The Team',
    stageColor: 'var(--stage-team)',
    desc: 'Governance quality, board composition, advisor social proof, investor follow-on signals.',
    mermaid: `flowchart TD
    A["Begin Board\\n& Advisors"] --> B["Board Members"]
    B --> B1["Independent\\nDirectors"]
    B --> B2["Investor-Appointed"]
    B --> B3["Management\\nDirectors"]
    B1 & B2 & B3 --> C["Board Committees"]
    C --> D["Strategic Advisors\\n& Their Value"]
    D --> E["Existing Investors"]
    E --> E1["Ownership Stakes"]
    E --> E2["Follow-On\\nCommitments"]
    E1 & E2 --> F{"Stage\\nAdaptation"}
    F -->|Series A| FA["Informal board\\n+ notable angels"]
    F -->|Series B| FB["Formal governance\\n+ investor reps"]
    F -->|Pre-IPO| FC["Independent dirs,\\naudit committee, D&O"]
    FA & FB & FC --> G["Section Complete"]

    style A fill:#2a1525,stroke:#e05882,color:#e8ecf4
    style F fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style G fill:#1a3040,stroke:#e05882,color:#e8ecf4`
  },
  {
    id: 's11',
    title: 'S11: Historical Financials',
    stage: 'Stage 5 — The Numbers',
    stageColor: 'var(--stage-numbers)',
    desc: 'P&L, balance sheet, cash flow for 2-3 years. Must match model Actuals tabs exactly.',
    mermaid: `flowchart TD
    A["Begin Historical\\nFinancials"] --> B["P&L Summary\\n(2-3 Years)"]
    B --> B1["Revenue by Type"]
    B --> B2["COGS → Gross Profit"]
    B --> B3["OpEx: R&D, S&M, G&A"]
    B --> B4["EBITDA & Net Income"]
    B1 & B2 & B3 & B4 --> C["Balance Sheet\\nSnapshot"]
    C --> D["Cash Flow Summary"]
    D --> E["Non-Recurring Items\\n& Normalization"]
    E --> F["Quarterly Trends"]
    F --> G{"Every Number\\nMatches Model\\nActuals Tab?"}
    G -->|No| H["Reconcile: Memo →\\nModel → GL\\n(<1% Tolerance)"]
    G -->|Yes| I{"Consistent with\\nS1 & S6 Metrics?"}
    H --> G
    I -->|No| J["Fix Cross-Section\\nDiscrepancies"]
    I -->|Yes| K["Section Complete"]
    J --> I

    style A fill:#1e1535,stroke:#8b6cf0,color:#e8ecf4
    style G fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style I fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style K fill:#1a3040,stroke:#8b6cf0,color:#e8ecf4`
  },
  {
    id: 's12',
    title: 'S12: Financial Projections',
    stage: 'Stage 5 — The Numbers',
    stageColor: 'var(--stage-numbers)',
    desc: '3-5 year forecast with transparent assumptions, scenario analysis, and path to profitability.',
    mermaid: `flowchart TD
    A["Begin Financial\\nProjections"] --> B["3-5 Year Forecast"]
    B --> B1["Revenue Forecast"]
    B --> B2["Gross Margin\\nTrajectory"]
    B --> B3["OpEx Plan\\n(% of Revenue)"]
    B --> B4["EBITDA Margin Path"]
    B --> B5["Free Cash Flow"]
    B1 & B2 & B3 & B4 & B5 --> C["Key Assumptions\\n(Stated Explicitly)"]
    C --> C1["Customer Growth"]
    C --> C2["ACV & NRR"]
    C --> C3["Pricing Changes"]
    C --> C4["Headcount Growth"]
    C1 & C2 & C3 & C4 --> D["Revenue Bridge"]
    D --> D1["New Logos\\n+ Expansion\\n- Churn\\n= Net New ARR"]
    D1 --> E["Scenario Analysis"]
    E --> E1["Base Case"]
    E --> E2["Bull Case"]
    E --> E3["Bear Case"]
    E1 & E2 & E3 --> F{"Every Projection\\nTraces to Model Cell?"}
    F -->|No| G["Map to Model"]
    F -->|Yes| H["Section Complete"]
    G --> F

    style A fill:#1e1535,stroke:#8b6cf0,color:#e8ecf4
    style F fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style H fill:#1a3040,stroke:#8b6cf0,color:#e8ecf4`
  },
  {
    id: 's13',
    title: 'S13: Cash & Runway',
    stage: 'Stage 5 — The Numbers',
    stageColor: 'var(--stage-numbers)',
    desc: 'Current cash, trailing 3-month burn, runway months, post-raise waterfall, milestone mapping.',
    mermaid: `flowchart TD
    A["Begin Cash &\\nRunway Analysis"] --> B["Current Cash Position\\n(Most Recent Month-End)"]
    B --> C["Monthly Burn Rate\\n(Trailing 3-Month Avg)"]
    C --> D["Runway = Cash ÷ Burn\\n(Months Remaining)"]
    D --> E["Cash Waterfall"]
    E --> E1["Opening Cash"]
    E --> E2["+ Raise Amount"]
    E --> E3["- Projected Burn"]
    E --> E4["= Ending Cash"]
    E1 & E2 & E3 & E4 --> F["Milestone Mapping"]
    F --> F1["Each Milestone →\\nCapital Required\\n+ Timeline"]
    F1 --> G["Post-Raise Runway\\n(Target: 18-24 Months)"]
    G --> H["Break-Even Point\\n(Base Case)"]
    H --> I{"Cash from BS Tab?\\nBurn from CF Tab?"}
    I -->|No| J["Reconcile with\\nModel & Bank Stmts"]
    I -->|Yes| K["Section Complete"]
    J --> I

    style A fill:#1e1535,stroke:#8b6cf0,color:#e8ecf4
    style I fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style K fill:#1a3040,stroke:#8b6cf0,color:#e8ecf4`
  },
  {
    id: 's14',
    title: 'S14: The Raise',
    stage: 'Stage 6 — The Ask',
    stageColor: 'var(--stage-ask)',
    desc: 'Round size, structure, valuation, use of proceeds, dilution, and transaction mechanics.',
    mermaid: `flowchart TD
    A["Begin\\nThe Raise"] --> B["Round Size\\n& Structure"]
    B --> B1["Equity / Note /\\nSAFE / Combo"]
    B1 --> C["Valuation"]
    C --> C1["Pre-Money"]
    C --> C2["Post-Money"]
    C1 & C2 --> D["Use of Proceeds\\n(3-5 Categories)"]
    D --> D1["$ Amount &\\n% per Category"]
    D1 --> E["Dilution Impact"]
    E --> E1["Pro Forma\\nOwnership Table"]
    E --> E2["Option Pool\\nPre & Post"]
    E1 & E2 --> F["Transaction Mechanics"]
    F --> F1["Primary vs Secondary"]
    F --> F2["Insider Participation"]
    F --> F3["Lead Investor Status"]
    F --> F4["Syndicate Strategy"]
    F --> F5["Term Sheet Status"]
    F --> F6["Process Timeline"]
    F1 & F2 & F3 & F4 & F5 & F6 --> G{"UoP Ties to\\nHiring Plan, OpEx,\\n& Milestones?"}
    G -->|No| H["Align Across\\nSections"]
    G -->|Yes| I["Section Complete"]
    H --> G

    style A fill:#122a30,stroke:#56c4e8,color:#e8ecf4
    style G fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style I fill:#1a3040,stroke:#56c4e8,color:#e8ecf4`
  },
  {
    id: 's15',
    title: 'S15: Valuation Support',
    stage: 'Stage 6 — The Ask',
    stageColor: 'var(--stage-ask)',
    desc: 'Multi-methodology triangulation: comps, precedents, DCF, with production controls.',
    mermaid: `flowchart TD
    A["Begin Valuation\\nSupport"] --> B["Comparable\\nCompany Analysis"]
    B --> B1["3-8 Public/Private\\nComps"]
    B --> B2["EV/NTM Revenue\\nor EV/ARR"]
    B --> B3["Growth-Adjusted\\nMultiple"]
    B1 & B2 & B3 --> C["Precedent\\nTransactions"]
    C --> D{"Business Mature\\nEnough for DCF?"}
    D -->|Yes| E["DCF Analysis\\nWACC + Terminal Value"]
    D -->|No| F["Skip DCF"]
    E --> G["Triangulation"]
    F --> G
    G --> G1["Low / Mid / High\\nImplied Range"]
    G1 --> H["Premium/Discount\\nRationale"]
    H --> I["Production Controls"]
    I --> I1["Comp Refresh <30d"]
    I --> I2["Sensitivity Analysis"]
    I --> I3["Market Condition Note"]
    I --> I4["Internal Bridge-to-Offer\\n(NOT in investor version)"]
    I1 & I2 & I3 & I4 --> J{"Revenue/ARR\\nMatch Model?"}
    J -->|No| K["Reconcile"]
    J -->|Yes| L["Section Complete"]
    K --> J

    style A fill:#122a30,stroke:#56c4e8,color:#e8ecf4
    style D fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style J fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style L fill:#1a3040,stroke:#56c4e8,color:#e8ecf4`
  },
  {
    id: 's16',
    title: 'S16: Key Risks & Mitigants',
    stage: 'Stage 7 — Risk & Close',
    stageColor: 'var(--stage-risk)',
    desc: 'Candid risk assessment across 4 dimensions, each paired with a specific mitigant.',
    mermaid: `flowchart TD
    A["Begin Key Risks\\n& Mitigants"] --> B["Market Risks"]
    B --> B1["Demand Volatility"]
    B --> B2["Competitive Threats"]
    B --> B3["Macro Sensitivity"]
    A --> C["Execution Risks"]
    C --> C1["Key Person Dependency"]
    C --> C2["Hiring Challenges"]
    C --> C3["Scaling Operations"]
    A --> D["Financial Risks"]
    D --> D1["Revenue Concentration"]
    D --> D2["Capital Efficiency"]
    D --> D3["Currency/Debt Exposure"]
    A --> E["Regulatory Risks"]
    E --> E1["Compliance"]
    E --> E2["Pending Legislation"]
    E --> E3["IP Exposure"]
    B1 & B2 & B3 & C1 & C2 & C3 & D1 & D2 & D3 & E1 & E2 & E3 --> F["Pair Each Risk\\nwith Specific Mitigant"]
    F --> G{"Mitigants\\nMeasurable?"}
    G -->|No| H["Strengthen with\\nSpecific Initiatives"]
    G -->|Yes| I["Section Complete"]
    H --> G

    style A fill:#2a2010,stroke:#e8a04a,color:#e8ecf4
    style G fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style I fill:#1a3040,stroke:#e8a04a,color:#e8ecf4`
  },
  {
    id: 's17',
    title: 'S17: Milestones & Path Forward',
    stage: 'Stage 7 — Risk & Close',
    stageColor: 'var(--stage-risk)',
    desc: '12-18 month plan with quarterly waypoints tied to use of proceeds.',
    mermaid: `flowchart TD
    A["Begin Milestones\\n& Path Forward"] --> B["12-Month Milestones\\n(3-5 Targets)"]
    B --> B1["Revenue Targets"]
    B --> B2["Product Milestones"]
    B --> B3["Hiring Targets"]
    B --> B4["Market Expansion"]
    B1 & B2 & B3 & B4 --> C["18-Month\\nStretch Targets"]
    C --> D["Next-Round\\nTrigger Points"]
    D --> D1["Metrics Signaling\\nReadiness for\\nNext Raise"]
    D1 --> E["Long-Term Vision\\n(2-5 Years)"]
    E --> E1["Exit Path\\nConsiderations"]
    E1 --> F{"Each Milestone\\nTied to UoP?"}
    F -->|No| G["Link Capital →\\nMilestone → Timeline"]
    F -->|Yes| H["Section Complete"]
    G --> F

    style A fill:#2a2010,stroke:#e8a04a,color:#e8ecf4
    style F fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style H fill:#1a3040,stroke:#e8a04a,color:#e8ecf4`
  },
  {
    id: 's18',
    title: 'S18: Appendices',
    stage: 'Stage 7 — Risk & Close',
    stageColor: 'var(--stage-risk)',
    desc: 'Evidence room: full model, cap table waterfall, case studies, IP summary, data room index.',
    mermaid: `flowchart TD
    A["Begin Appendix\\nOrganization"] --> B["Apply Naming\\nConvention"]
    B --> B1["A-Series: Financial"]
    B --> B2["B-Series: Cap Table/Legal"]
    B --> B3["C-Series: Product/Market"]
    B --> B4["D-Series: Team/Governance"]
    B1 & B2 & B3 & B4 --> C["Claim-to-Evidence\\nAudit"]
    C --> C1["Every Core Claim →\\nSpecific Appendix Ref"]
    C1 --> D{"Unsupported\\nClaims Found?"}
    D -->|Yes| E["Add Evidence\\nor Remove Claim"]
    D -->|No| F["Apply Confidentiality\\nTiering"]
    E --> D
    F --> F1["Internal Only"]
    F --> F2["Board"]
    F --> F3["Investor (NDA)"]
    F --> F4["Public"]
    F1 & F2 & F3 & F4 --> G["Build Data Room\\nIndex (Appendix Z)"]
    G --> G1["Title, Version,\\nDate, Owner"]
    G1 --> H["Section Complete"]

    style A fill:#2a2010,stroke:#e8a04a,color:#e8ecf4
    style D fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style H fill:#1a3040,stroke:#e8a04a,color:#e8ecf4`
  },
  {
    id: 's19',
    title: 'S19: Decision & Approval Block',
    stage: 'Decision & Production',
    stageColor: 'var(--stage-prepost)',
    desc: 'Formal go/no-go instrument: decision requested, conditions, non-negotiables, escalation triggers.',
    mermaid: `flowchart TD
    A["Begin Decision\\n& Approval Block"] --> B["State Decision\\nRequested"]
    B --> B1["Authorize Investor\\nProcess?"]
    B --> B2["Approve Valuation\\nRange?"]
    B --> B3["Board Resolution\\nto Issue Shares?"]
    B1 & B2 & B3 --> C["Approval Conditions"]
    C --> C1["Min Round Size"]
    C --> C2["Lead Identified"]
    C --> C3["Legal Review Complete"]
    C1 & C2 & C3 --> D["Non-Negotiables"]
    D --> D1["Valuation Floor"]
    D --> D2["Max Dilution Cap"]
    D --> D3["Board Seat Terms"]
    D1 & D2 & D3 --> E["Acceptable\\nNegotiation Range"]
    E --> F["Fallback Plan"]
    F --> F1["Bridge Financing"]
    F --> F2["Cost Reduction"]
    F --> F3["Alternative Structure"]
    F1 & F2 & F3 --> G["Escalation Triggers"]
    G --> G1["Below Floor Offer"]
    G --> G2["Material Adverse Event"]
    G --> G3["Lead Withdrawal"]
    G1 & G2 & G3 --> H["Collect Sign-Offs"]
    H --> H1["CEO ✓"]
    H --> H2["CFO ✓"]
    H --> H3["Legal ✓"]
    H --> H4["Board Chair ✓"]
    H --> H5["Memo Owner ✓"]
    H1 & H2 & H3 & H4 & H5 --> I["Memo Approved\\nfor Distribution"]

    style A fill:#1a2235,stroke:#6b7a96,color:#e8ecf4
    style I fill:#1a3040,stroke:#4a8eff,color:#e8ecf4`
  },
  {
    id: 'checklist',
    title: 'Pre-Submission Checklist',
    stage: 'Decision & Production',
    stageColor: 'var(--stage-prepost)',
    desc: 'Final quality check after all gates cleared: financial consistency, legal, production quality.',
    mermaid: `flowchart TD
    A["Pre-Submission\\nChecklist"] --> B["Financial Consistency"]
    B --> B1["All figures match\\nmodel exactly"]
    B --> B2["Revenue consistent\\nacross S1/S6/S11/S12/S14"]
    B --> B3["Burn = trailing 3mo\\nactuals, not projections"]
    B --> B4["UoP ties to hiring\\nplan & milestones"]
    B --> B5["Cap table reconciled"]
    B1 & B2 & B3 & B4 & B5 --> C["Valuation & Market"]
    C --> C1["Comps refreshed\\n<30 days"]
    C --> C2["Precedents dated\\n& sourced"]
    C --> C3["Bridge-to-offer\\nNOT in investor version"]
    C1 & C2 & C3 --> D["Legal & Compliance"]
    D --> D1["Customer names\\ncleared (NDA)"]
    D --> D2["Cap table reviewed\\nby counsel"]
    D --> D3["Risk disclosures\\nreviewed"]
    D --> D4["Confidentiality\\nlegend on cover"]
    D1 & D2 & D3 & D4 --> E["Production Quality"]
    E --> E1["Exec summary\\nstands alone"]
    E --> E2["No section >50%\\nover page cap"]
    E --> E3["Every claim →\\nappendix ref"]
    E --> E4["All 5 gates\\npassed"]
    E --> E5["Decision block\\ncomplete"]
    E1 & E2 & E3 & E4 & E5 --> F{"All Items\\nPassed?"}
    F -->|No| G["Resolve Failures\\n& Re-Check"]
    F -->|Yes| H["CLEARED FOR\\nDISTRIBUTION"]
    G --> F

    style A fill:#1a2235,stroke:#6b7a96,color:#e8ecf4
    style F fill:#2a2a10,stroke:#f0a050,color:#e8ecf4
    style H fill:#0d3020,stroke:#3ecfb4,color:#e8ecf4`
  }
];

// ──────────────────────────────────────────────
// APP RENDER
// ──────────────────────────────────────────────
let activeSection = 'overview';
let codeVisible = {};
let copyStates = {};

function renderSectionNav(current) {
  const idx = sections.findIndex(s => s.id === current.id);
  const prev = idx > 0 ? sections[idx - 1] : null;
  const next = idx < sections.length - 1 ? sections[idx + 1] : null;

  return `
    <div class="section-nav">
      <button class="nav-arrow" ${prev ? `onclick="navigate('${prev.id}')"` : 'disabled'}>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
        <span class="nav-arrow-label">${prev ? prev.title : ''}</span>
      </button>
      <span class="section-nav-spacer"></span>
      <span class="section-nav-counter">${idx + 1} / ${sections.length}</span>
      <span class="section-nav-spacer"></span>
      <button class="nav-arrow" ${next ? `onclick="navigate('${next.id}')"` : 'disabled'}>
        <span class="nav-arrow-label">${next ? next.title : ''}</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
      </button>
    </div>
  `;
}

function renderApp() {
  const app = document.getElementById('app');
  const current = sections.find(s => s.id === activeSection);

  app.innerHTML = `
    <div class="header">
      <div class="header-label">IC Production Blueprint v2.0</div>
      <h1>Flowchart Navigator</h1>
      <p>Interactive production flowcharts for every section of the company-side fundraising memo — from transaction intake through final sign-off.</p>
    </div>
    <div class="nav-bar">
      <div class="nav-inner">
        ${sections.map(s => `
          <button class="nav-btn ${s.id === activeSection ? 'active' : ''} ${s.id === 'overview' ? 'overview-btn' : ''}"
                  onclick="navigate('${s.id}')">
            ${s.id === 'overview' ? '⬡ Overview' : s.title}
          </button>
        `).join('')}
      </div>
    </div>
    <div class="main">
      <div class="section-view" key="${current.id}">
        ${renderSectionNav(current)}
        <div class="section-header">
          <div class="section-stage-label" style="background: ${current.stageColor}22; color: ${current.stageColor}; border: 1px solid ${current.stageColor}44;">
            ${current.stage}
          </div>
          <h2 class="section-title">${current.title}</h2>
          <p class="section-desc">${current.desc}</p>
        </div>
        <div class="flowchart-card">
          <div class="flowchart-toolbar">
            <span class="flowchart-toolbar-label">Mermaid Flowchart</span>
            <button class="copy-btn ${copyStates[current.id] ? 'copied' : ''}" onclick="copyMermaid('${current.id}')">
              ${copyStates[current.id]
                ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg> Copied'
                : '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg> Copy Mermaid'}
            </button>
          </div>
          <div class="flowchart-render">
            <div class="mermaid" id="mermaid-${current.id}">
              ${current.mermaid}
            </div>
          </div>
          <div class="code-toggle">
            <button class="code-toggle-btn" onclick="toggleCode('${current.id}')">
              ${codeVisible[current.id] ? '▾ Hide source' : '▸ Show source'}
            </button>
          </div>
          <div class="code-block ${codeVisible[current.id] ? 'visible' : ''}" id="code-${current.id}">
            <pre>${escapeHtml(current.mermaid.trim())}</pre>
          </div>
        </div>
        ${buildPrevNext(current.id)}
      </div>
    </div>
  `;

  // Re-render mermaid
  mermaid.run({ nodes: [document.getElementById(`mermaid-${current.id}`)] });
}

function buildPrevNext(currentId) {
  const idx = sections.findIndex(s => s.id === currentId);
  const prev = idx > 0 ? sections[idx - 1] : null;
  const next = idx < sections.length - 1 ? sections[idx + 1] : null;

  return `
    <div class="section-nav">
      <button class="section-nav-btn prev ${!prev ? 'disabled' : ''}"
              ${prev ? `onclick="navigate('${prev.id}')"` : ''}>
        <span class="nav-arrow">←</span>
        <span class="nav-label">
          <span class="nav-dir">Previous</span>
          <span class="nav-name">${prev ? prev.title : ''}</span>
        </span>
      </button>
      <button class="section-nav-btn next ${!next ? 'disabled' : ''}"
              ${next ? `onclick="navigate('${next.id}')"` : ''}>
        <span class="nav-label">
          <span class="nav-dir">Next</span>
          <span class="nav-name">${next ? next.title : ''}</span>
        </span>
        <span class="nav-arrow">→</span>
      </button>
    </div>
  `;
}

function navigate(id) {
  activeSection = id;
  renderApp();
  document.querySelector('.nav-bar').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

function toggleCode(id) {
  codeVisible[id] = !codeVisible[id];
  renderApp();
}

function copyMermaid(id) {
  const section = sections.find(s => s.id === id);
  navigator.clipboard.writeText(section.mermaid.trim()).then(() => {
    copyStates[id] = true;
    renderApp();
    setTimeout(() => {
      copyStates[id] = false;
      renderApp();
    }, 2000);
  });
}

function escapeHtml(str) {
  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}

// Init mermaid
mermaid.initialize({
  startOnLoad: false,
  theme: 'dark',
  themeVariables: {
    primaryColor: '#2a3550',
    primaryTextColor: '#e8ecf4',
    primaryBorderColor: '#4a6fa5',
    lineColor: '#4a6fa5',
    secondaryColor: '#1e2330',
    tertiaryColor: '#181c26',
    fontFamily: 'Outfit, sans-serif',
    fontSize: '13px',
    nodeBorder: '#4a6fa5',
    clusterBkg: '#12151c',
    clusterBorder: '#2a3040',
    edgeLabelBackground: '#12151c'
  },
  flowchart: {
    useMaxWidth: true,
    htmlLabels: true,
    curve: 'basis',
    padding: 15
  }
});

// Keyboard navigation
document.addEventListener('keydown', (e) => {
  if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
  const idx = sections.findIndex(s => s.id === activeSection);
  if (e.key === 'ArrowLeft' && idx > 0) {
    navigate(sections[idx - 1].id);
  } else if (e.key === 'ArrowRight' && idx < sections.length - 1) {
    navigate(sections[idx + 1].id);
  }
});

// Initial render
renderApp();
</script>
</body>
</html>
